<!DOCTYPE html>
<html>
<head>
  <title>OCR Upload</title>
  <link rel="stylesheet" href="/static/style.css">
  <script src="/static/theme.js" defer></script>
</head>
<body>

<button class="theme-toggle" onclick="toggleTheme()">ðŸŒ—</button>

<h2>Document OCR</h2>

<!-- EMPTY STATE -->
<div id="emptyState">
  <p style="color:#666;">
    ðŸ“„ No document uploaded yet.<br>
    Upload a PNG, JPG, or PDF to get started.
  </p>
</div>

<form method="post" action="/upload" enctype="multipart/form-data" onsubmit="startProcessing()">

  <input
    type="file"
    id="fileInput"
    name="file"
    accept=".png,.jpg,.jpeg,.pdf"
    required
    title="Upload a clear image or PDF (max 10MB)"
    onchange="fileSelected()"
  >

  <br><br>

  <button type="button" onclick="togglePreview()" title="Verify document before processing">
    Show / Hide Preview
  </button>

  <br><br>

  <button type="submit">Process Document</button>

</form>

<!-- PREVIEW -->
<div id="previewContainer" style="display:none; margin-top:15px;">
  <h4>Preview</h4>
  <img id="imagePreview" style="max-width:400px; display:none;">
  <iframe id="pdfPreview" style="width:600px; height:400px; display:none;"></iframe>
</div>

<!-- PROCESSING LOADER -->
<div id="loader" style="display:none; margin-top:20px;">
  <p>ðŸ”„ Processing documentâ€¦</p>
  <p id="stageText">Preparing analysisâ€¦</p>
</div>

<script>
let previewVisible = false;

function fileSelected() {
  document.getElementById("emptyState").style.display = "none";
}

function togglePreview() {
  const file = fileInput.files[0];
  if (!file) return;

  previewVisible = !previewVisible;
  previewContainer.style.display = previewVisible ? "block" : "none";

  imagePreview.style.display = "none";
  pdfPreview.style.display = "none";

  if (file.type.startsWith("image/")) {
    const reader = new FileReader();
    reader.onload = e => {
      imagePreview.src = e.target.result;
      imagePreview.style.display = "block";
    };
    reader.readAsDataURL(file);
  } else if (file.type === "application/pdf") {
    pdfPreview.src = URL.createObjectURL(file);
    pdfPreview.style.display = "block";
  }
}

function startProcessing() {
  loader.style.display = "block";

  const stages = [
    "Reading document layoutâ€¦",
    "Extracting key fieldsâ€¦",
    "Validating resultsâ€¦",
    "Finalizing outputâ€¦"
  ];

  let i = 0;
  setInterval(() => {
    if (i < stages.length) {
      stageText.innerText = stages[i++];
    }
  }, 800);
}
</script>

</body>
</html>
